---
sidebar_position: 4
---

# マルチテナントアーキテクチャとコンテナDB

## はじめに

この章では、Oracle Database 12c以降で導入された重要な機能である「マルチテナントアーキテクチャ」について詳しく学んでいきます。

### マルチテナント機能の進化

マルチテナントアーキテクチャは、Oracle Database 12cで初めて導入された革新的な機能です。  
その後のバージョンアップで機能が強化され、現在では多くの企業で活用されています。

Oracle Database 12cでは、基本的なマルチテナント機能が導入され、データベース環境の統合管理が可能になりました。  
19cではより高度な管理機能が追加され、21c以降ではクラウド環境との連携が強化されています。

### 主なメリットとデメリット

マルチテナントアーキテクチャの採用を検討する際は、以下のような点を考慮する必要があります：

メリット：
- 複数のデータベース環境を効率的に管理できる
- システム全体の運用コストを削減できる
- セキュリティ管理が容易になる
- データベース環境の移行や複製が簡単

デメリット：
- 初期導入時の計画と準備が重要
- 管理者の新しいスキル習得が必要
- Enterprise Edition以上のライセンスが必要

これらの特徴を理解した上で、具体的な仕組みと活用方法を見ていきましょう。

## 4-1. マルチテナントアーキテクチャの基本概念

### マルチテナントとは

マルチテナントアーキテクチャは、一つのデータベース環境の中で、複数の独立したデータベース環境を効率的に運用する仕組みです。  
この仕組みを理解するために、重要な概念を説明していきます。

### 重要な用語の説明

1. コンテナデータベース（CDB: Container Database）
   - マルチテナント環境の基盤となる、大きな「入れ物」としてのデータベース
   - システムの共通リソースを管理
   - メモリやプロセスを一元管理

2. プラガブルデータベース（PDB: Pluggable Database）
   - CDBの中に作られる個別のデータベース環境
   - それぞれが独立したデータやユーザーを持つ
   - 必要に応じて追加・削除が可能

3. ルートコンテナ（CDB$ROOT）
   - CDBの中核となる管理用のコンテナ
   - システム全体の設定や共通のコンポーネントを管理

## 4-2. マルチテナントアーキテクチャの構造

### 全体構造の解説

```
CDB（コンテナデータベース）
│
├── CDB$ROOT（ルートコンテナ）
│   ├── 共通ユーザー
│   └── 共通オブジェクト
│
├── PDB1（プラガブルデータベース1）
│   ├── アプリケーション1のデータ
│   └── ローカルユーザー
│
├── PDB2（プラガブルデータベース2）
│   ├── アプリケーション2のデータ
│   └── ローカルユーザー
│
└── PDB3（プラガブルデータベース3）
    ├── アプリケーション3のデータ
    └── ローカルユーザー
```

### 各コンポーネントの詳細説明

#### ルートコンテナ（CDB$ROOT）の役割
- システム全体の管理情報を保持
- 共通ユーザーとロールの管理
- 全PDBで共有されるデータディクショナリの管理
- セキュリティ設定の一元管理

#### プラガブルデータベース（PDB）の特徴
- 独自のデータファイルを持つ
- 独自のユーザーとスキーマを管理可能
- 他のPDBとは独立して運用可能
- 必要に応じて別のCDBへの移動が可能

## 4-3. マルチテナントアーキテクチャのメリット

### 1. 運用管理の効率化

#### システム管理の統合
- バックアップ/リカバリの一元管理
- パッチ適用作業の効率化
- メモリリソースの効率的な利用

#### データベース環境の柔軟な管理
- 新しいデータベース環境の迅速な提供
- 必要に応じたリソースの再配分
- 環境の複製や移行が容易

### 2. コスト削減効果

#### ハードウェアリソースの効率的な利用
- サーバーの集約が可能
- メモリやプロセスの共有による効率化
- ストレージの使用効率の向上

#### 管理工数の削減
- バックアップ作業の簡素化
- パッチ適用作業の効率化
- 監視作業の一元化

### 3. セキュリティの強化

#### アクセス制御の階層化
- CDBレベルでの一元管理
- PDBレベルでの個別管理
- きめ細かなセキュリティ設定が可能

#### データの分離
- PDB間でのデータ分離
- アプリケーション単位でのセキュリティ管理
- テナント間の影響の最小化

## 4-4. Oracleのバージョンとマルチテナント機能

### バージョン別の特徴

#### Oracle Database 12c
- マルチテナント機能の導入
- 基本的なPDB管理機能の提供
- PDB数の制限あり（Enterprise Editionで限定数）

#### Oracle Database 19c
- マルチテナント機能の拡充
- PDB管理機能の強化
- より柔軟なリソース管理

#### Oracle Database 21c以降
- さらなる機能の拡充
- クラウド環境との親和性向上
- 運用管理機能の強化

### 各バージョンのメリット・デメリット

#### Oracle Database 12c
メリット：
- マルチテナント環境への移行が容易
- 基本的な統合管理が可能

デメリット：
- PDB数の制限が厳しい
- 一部の管理機能が限定的

#### Oracle Database 19c
メリット：
- より柔軟なPDB管理が可能
- パフォーマンス面での改善
- 運用管理機能の充実

デメリット：
- 新しい機能の学習が必要
- 移行作業の計画が重要

## 4-5. プラガブルDBとコンテナDBの関係性

### 相互関係の詳細

プラガブルデータベース（PDB）とコンテナデータベース（CDB）は、それぞれが独自の役割を持ちながら、密接に連携して動作します。

#### リソースの共有と分離

1. メモリの共有
   - SGAは CDB レベルで一元管理
   - PDBごとにメモリ使用量の制限を設定可能
   - 必要に応じて動的にメモリを再配分

2. プロセスの管理
   - バックグラウンドプロセスは CDB で一元管理
   - PDBごとにセッション数の制限を設定可能
   - リソース効率の最適化が可能

3. ストレージの管理
   - データファイルは PDB ごとに独立
   - 表領域の管理は PDB 単位で実施
   - バックアップは CDB 単位または PDB 単位で選択可能

### 実際の運用シーン

#### 1. 開発環境と本番環境の管理

```
本番用CDB
├── 本番PDB1（会計システム）
├── 本番PDB2（人事システム）
└── 本番PDB3（在庫管理システム）

開発用CDB
├── 開発PDB1（会計システム開発環境）
├── 開発PDB2（人事システム開発環境）
└── 開発PDB3（在庫管理システム開発環境）
```

このような構成により：
- 環境ごとの明確な分離
- リソースの効率的な配分
- 開発から本番への移行が容易

#### 2. 部門別システムの統合管理

```
統合管理CDB
├── PDB1（営業部門システム）
├── PDB2（製造部門システム）
└── PDB3（管理部門システム）
```

利点：
- 部門ごとのデータ分離
- 統合的なバックアップ管理
- リソースの効率的な利用

以下のページにより詳しい解説が記載されています。  
非常に重要な概念なので、参照して理解を深めましょう

- [**プラガブルDBとコンテナDBの関係性**](./page5.md)

## 4-6. マルチテナント環境の運用管理

### 日常的な運用作業

#### 1. 起動と停止の管理
```sql
-- CDBの起動（全PDBが起動）
STARTUP

-- 特定のPDBのみ起動
ALTER PLUGGABLE DATABASE pdb1 OPEN;

-- 特定のPDBのみ停止
ALTER PLUGGABLE DATABASE pdb1 CLOSE;
```

#### 2. バックアップとリカバリ
```sql
-- CDB全体のバックアップ
BACKUP DATABASE;

-- 特定のPDBのバックアップ
BACKUP PLUGGABLE DATABASE pdb1;
```

#### 3. パフォーマンス監視
- AWRレポートによる性能分析
- PDBごとのリソース使用状況確認
- メモリ使用効率の監視

### トラブルシューティングの基本

#### 1. 一般的な問題と対処方法

- PDBの接続エラー
  - リスナーの状態確認
  - PDBの状態確認
  - ネットワーク設定の確認

- パフォーマンス問題
  - メモリ使用状況の確認
  - セッション数の確認
  - I/O負荷の確認

#### 2. 診断手順

1. 問題の切り分け
   - CDBレベルの問題か
   - 特定のPDBの問題か
   - リソース競合の有無

2. ログの確認
   - アラートログの確認
   - トレースファイルの確認
   - AWRレポートの分析

3. 対処方法の選択
   - パラメータ調整
   - リソース再配分
   - 構成変更の検討

## 4-7. 導入時の検討ポイント

### システム要件の確認

1. ハードウェアリソース
   - CPU要件
   - メモリ要件
   - ストレージ要件

2. ソフトウェア要件
   - Oracleバージョン
   - オプション機能の必要性
   - パッチレベル

### 移行計画の立案

1. 現状分析
   - 既存データベースの洗い出し
   - 依存関係の確認
   - アプリケーション影響度調査

2. 移行方式の選択
   - 一括移行
   - 段階的移行
   - ハイブリッド運用

3. テスト計画
   - 単体テスト
   - 統合テスト
   - 性能テスト

## まとめ

この章では、マルチテナントアーキテクチャの基本概念から実践的な運用管理まで学びました：

1. CDBとPDBの関係性について理解
2. 効率的な運用管理の方法を習得
3. 導入時の検討ポイントを確認
