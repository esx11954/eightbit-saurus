---
sidebar_position: 3
---

# OracleDBの基本アーキテクチャ

## はじめに
 
この章では、実際にOracleデータベースがどのように動いているのか、  
その基本的な仕組みを理解していきます。

データベースは多くのユーザーが同時に利用し、大量のデータを安全に管理する必要があります。  
そのために、Oracleデータベースは効率的なデータ処理と安全性を確保する仕組みを備えています。

## 3-1. Oracleデータベースの構成要素と関係性

### データベースの基本的な仕組み

私たちがデータベースを使う時、「データの参照（読み取り）」と「データの更新（書き込み）」という操作を行います。  
これらの操作を素早く、かつ安全に行うために、Oracleデータベースは二つの場所を使い分けています。

一つは「メモリ構造」と呼ばれる部分で、データを一時的に保管し、高速な処理を実現します。  
もう一つは「ディスク構造」と呼ばれる部分で、データを永続的に保存します。  
この二つをうまく組み合わせることで、高速な処理と安全性を両立しているのです。

### メモリ構造の詳しい説明

メモリ構造は、データベースの「作業場所」として機能します。  
主に二つの領域があり、それぞれ異なる役割を持っています。

#### システムグローバル領域（SGA）について

SGAは、データベースを利用する全てのユーザーで共有する領域です。  
ここには以下のような場所があります：

1. データベースバッファキャッシュ  
よく使うデータを一時的に保管する場所です。  
たとえば、多くのユーザーが頻繁に参照する商品マスタのデータなどが保管されます。  
ディスクへのアクセスを減らすことで、処理を高速化します。

2. 共有プール  
SQLの実行計画やデータベースの様々な情報を保管する場所です。  
一度作成した実行計画を再利用することで、効率的な処理を実現します。

3. REDOログバッファ  
データの変更内容を一時的に記録する場所です。  
システムに問題が発生した場合でも、この記録を使ってデータを復旧することができます。

#### プログラムグローバル領域（PGA）について

PGAは、各ユーザーが個別に使用する作業領域です。  
データの並び替えや集計などの作業をする時に使用します。  
ユーザーごとに独立した領域を持つことで、他のユーザーの処理に影響を与えることなく作業を行えます。

### ディスク構造の詳しい説明

ディスク構造は、データを永続的に保存する場所です。  
三種類のファイルがあり、それぞれが重要な役割を担っています：

1. データファイル  
実際のデータを保存するファイルです。  
テーブルやインデックスのデータが格納されています。  
これらのファイルは適切に管理され、必要に応じてサイズを拡張することもできます。

2. REDOログファイル  
データベースへの変更履歴を記録するファイルです。  
システムが予期せず停止した場合でも、この履歴を使ってデータを復旧することができます。  
データの安全性を確保する上で、非常に重要な役割を果たします。

3. 制御ファイル  
データベース全体の設定情報を管理するファイルです。  
データファイルやREDOログファイルの場所、データベースの状態など、重要な情報が記録されています。

## 3-2. 動作原理

### データベースの基本的な動き

データベースの動作を理解することは、システムの性能や安全性を考える上で重要です。  
主な動作として「データの参照」と「データの更新」があります。

#### データを参照する時の動き

データを参照する時、Oracleデータベースは以下のような手順で処理を行います：

1. ユーザーからの要求受付  
まず、ユーザーからデータを見たいという要求（SQL文）を受け付けます。

2. 実行計画の確認  
共有プールで、同じようなSQL文が以前に実行されているか確認します。  
過去に実行されていれば、その時の実行計画を再利用できます。

3. データの検索  
まず、データベースバッファキャッシュ内を検索します。  
求めているデータがあれば、そのまま返却できます。  
もしなければ、データファイルからデータを読み込みます。

4. 結果の返却  
取得したデータをユーザーに返却します。  
また、読み込んだデータはバッファキャッシュに保存され、次回の参照時に再利用できます。

#### データを更新する時の動き

データを更新する時は、データの安全性を確保するため、より慎重な処理が行われます：

1. 更新要求の受付  
ユーザーからデータを変更したいという要求を受け付けます。

2. データの準備  
更新対象のデータをバッファキャッシュに読み込みます。  
すでにバッファキャッシュにある場合は、その内容を使用します。

3. 変更の記録  
データを変更する前に、変更内容をREDOログバッファに記録します。  
これにより、システムに問題が発生した場合でも、データを復旧できます。

4. データの更新  
バッファキャッシュ上のデータを更新します。  
この時点では、まだディスク上のデータファイルは更新されていません。

5. 変更の確定  
トランザクションが確定（コミット）されると、REDOログバッファの内容がREDOログファイルに書き込まれます。

6. ディスクへの反映  
更新されたデータは、適切なタイミングでデータファイルに書き込まれます。  
この処理はバックグラウンドで実行され、ユーザーの処理に影響を与えません。

## 3-3. 他のデータベースとの違い

### 自動化機能の充実

Oracleデータベースには、システムの運用管理を支援する様々な自動化機能が備わっています。

#### メモリ管理の自動化

データベースの処理量に応じて、メモリの使用量を自動的に調整します。これにより、システム管理者が手動でメモリ設定を調整する必要性が減り、常に最適な状態でシステムを運用できます。

#### パフォーマンスの自動最適化

システムの状態を定期的に分析し、必要に応じて以下のような最適化を行います：
- SQL文の実行計画の見直し
- データベースの統計情報の更新
- メモリ領域の使用効率の改善

### 高い信頼性

#### データ保護機能

1. オンラインバックアップ  
システムを停止することなく、バックアップを取得できます。  
これにより、24時間365日稼働が必要なシステムでも、定期的なバックアップが可能です。

2. 自動リカバリ機能  
システムに障害が発生した場合でも、REDOログを使用して自動的にデータを復旧できます。

#### 運用管理の容易さ

1. 統合管理ツール  
データベースの状態監視、性能分析、障害検知などを一元的に管理できます。

2. トラブルシューティング機能  
問題が発生した際に、原因究明に必要な情報を自動的に収集します。

## まとめ

この章では、Oracleデータベースの基本的な仕組みについて学びました：

1. メモリ構造とディスク構造を使い分けることで、高速性と安全性を両立
2. データの参照と更新には、それぞれ適切な手順が用意されている
3. 様々な自動化機能により、安定した運用が可能


