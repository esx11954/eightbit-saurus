---
sidebar_position: 5
---




# プラガブルDBとコンテナDBの関係性

## はじめに

この章では、プラガブルデータベース（PDB）とコンテナデータベース（CDB）がどのように連携し、実際のシステムとして機能しているのかをより詳しく見ていきます。

## 5-1. 内部の仕組みを理解する

### メモリの使い方

コンテナデータベースとプラガブルデータベースは、メモリを効率的に共有しながら動作しています。  
システムグローバル領域（SGA）は、コンテナデータベース全体で一つ用意され、その中でプラガブルデータベースごとに必要な情報が管理されています。

たとえば、データベースのディクショナリ情報（データベースの様々な管理情報）は、CDB$ROOTと呼ばれる特別な領域に保存されます。  
この情報は全てのプラガブルデータベースで共有され、メモリを効率的に使用することができます。  
一方で、各プラガブルデータベース固有の情報は、それぞれのPDB専用の領域に保存されます。

データベースバッファキャッシュも同様に共有されますが、各PDBのデータは論理的に分離されています。これによりあるPDBでの処理が他のPDBに影響を与えることなく、安全にデータを管理できます。

### ファイルの管理方法

データベースのファイルは、共有されるものと個別に管理されるものに分かれています。  
制御ファイルやREDOログファイルなど、データベースの基本的な動作に必要なファイルは、コンテナデータベース全体で共有されます。

一方、実際のデータを格納するデータファイルはPDBごとに個別に管理されます。  
これにより各PDBは独立したデータ領域を持ち、他のPDBの影響を受けることなくデータを管理できます。

## 5-2. データの安全性を保つ仕組み

### トランザクション管理

データベースでは、データの更新や削除といった操作を安全に行うために、トランザクション管理という仕組みを使用します。  
マルチテナント環境では、このトランザクション管理もPDBごとに独立して行われます。

たとえば、PDB1で商品データを更新している最中にPDB2で顧客データを更新する場合、それぞれの処理は互いに影響を与えることなく安全に実行されます。  
これは、UNDOと呼ばれるデータ復旧用の情報をPDBごとに管理しているためです。

### データの保護

データを保護するための仕組みも階層的に管理されています。  
コンテナデータベース全体のバックアップを取得することもできますし、必要に応じて特定のPDBだけをバックアップすることも可能です。

また、システムに問題が発生した場合の復旧処理も影響範囲を最小限に抑えることができます。  
たとえば、あるPDBで問題が発生しても他のPDBは通常通り運用を続けることができます。

## 5-3. ユーザーとセキュリティの管理

### ユーザー管理の考え方

マルチテナント環境ではユーザーを二つの種類に分けて管理します。  
一つは「共通ユーザー」と呼ばれ、コンテナデータベース全体を管理できる特別なユーザーです。  
もう一つは「ローカルユーザー」と呼ばれ、特定のPDB内でのみ操作を行えるユーザーです。

この仕組みにより、例えばシステム管理者は共通ユーザーとしてデータベース全体を管理し、各部門のアプリケーション担当者はローカルユーザーとして自分の担当するPDBのみを操作する、といった運用が可能になります。

### セキュリティの確保

セキュリティも階層的に管理されています。  
コンテナデータベースレベルでの基本的なセキュリティ設定に加えて、PDBごとに詳細なセキュリティ設定を行うことができます。

例えば、パスワードポリシーやアクセス制限などの基本的なセキュリティルールはCDBレベルで設定し、各PDBではそれぞれの業務に応じた細かいアクセス権限を設定する、といった運用が可能です。

## 5-4. 実際の運用管理

### 日々の運用

データベースの起動や停止は基本的にコンテナデータベース全体で管理します。  
まずCDBが起動し、その後必要なPDBが順次開かれていきます。  
ただし、必要に応じて特定のPDBだけを停止したり起動したりすることも可能です。

また、パフォーマンスの管理も重要です。  
各PDBがどの程度のリソース（CPUやメモリなど）を使用しているかを監視し、必要に応じて調整することができます。  
これにより特定のPDBが他のPDBの処理に影響を与えることを防ぎます。

### メンテナンス作業

定期的なメンテナンス作業も、必要に応じてCDBレベルまたはPDBレベルで実行できます。  
例えば、統計情報の更新やパラメータの調整など、データベースの性能を最適に保つための作業を影響範囲を考慮しながら実行することができます。

## まとめ

この章では、プラガブルデータベースとコンテナデータベースの関係性について、内部の仕組みから実際の運用管理まで詳しく見てきました。これらの要素が適切に連携することで、効率的で安全なデータベース環境を実現しています。
