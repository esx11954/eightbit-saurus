# 関数生成とエラー解消の自動化（脱・Excel職人）

本演習では、前章で学習した
「**プロンプト設計の考え方**」 を前提として、  
業務の依頼内容を整理し、生成AI（Copilot）が実行できる形に変換する方法を学習します。

以降の演習では、共通の「**業務翻訳シート**」を用いて
「思考の整理 → AIへの指示 → 実行」という流れを繰り返し実践します。

![AI](./img/hikaku.jpg)

---

## 演習7-1　マスタ参照による列の自動補完

以降の演習では、以下の 「業務翻訳シート」 を用いて進めます。  
まず上司の依頼内容を整理し、生成AI（Copilot）が実行できる形に翻訳したうえで、  
その指示をもとにExcel操作を行ってください。

<details><summary>
業務翻訳シートはこちら
</summary>
## 業務翻訳シート(例)

### ① 元の業務依頼
例）  
受注リストに商品名を入れておいて

---

### ② 業務の目的
例）  
製品IDだけでなく、商品名も確認できる状態にしたい

---

### ③ 参照するデータ
例）  
- 参照するシート：商品マスタ  
- キーになる列：製品ID  

---

### ④ 実行したい処理
例）  
- 受注リストの製品IDを使って  
- 商品マスタから商品名を取得する  
- 受注リストに商品名を表示する  

---

### ⑤ 結果の出力先
例）  
- 出力先シート：受注リスト  
- 出力先列：商品名列  

---

### ⑥ 例外・注意点
例）  
- 商品マスタに存在しない製品IDがある可能性がある  
- まずはエラーが出ないことを優先したい  

---

### ⑦ Copilotに渡す指示文
例）  

受注リストと商品マスタの2つのシートがあります。  
受注リストには製品IDがあり、商品マスタには製品IDと商品名があります。

製品IDをキーにして、  
商品マスタから商品名を取得し、  
受注リストの各行に商品名を表示してください。


</details>


| 項目 | 内容 |
|---|---|
| ケース | あなたは営業部の事務担当です。「受注リスト」シートには **製品ID** と **数量** のみが入力されています。一方、「商品マスタ」シートには **製品ID・商品名・単価** が管理されています。上司から「受注リストに商品名と単価も入れておいて」と依頼されました。 |
| 演習内容 | 上司の依頼を、Copilotが実行できる形に翻訳し、**製品IDをキーにして商品名・単価を自動補完**してください。関数名（VLOOKUP / XLOOKUP 等）を暗記している前提にはせず、**「やりたい業務内容」からAIに作業手順や関数を提案させて実行**することを目的とします。 |
| 提出物 | ① Copilotに入力した指示文（上司の依頼をAI向けに翻訳した文章）<br />② 商品名・単価が補完されたExcelファイル |
| 留意点 | ・**列名**（例：製品ID／商品名／単価）が変わっても成立する指示文になっているか<br />・「受注リストのどの列に何を入れるか」が曖昧になっていないか<br />・キー（製品ID）が一致しない場合の挙動をCopilotに確認しているか |

---

## 演習7-2　マスタ参照＋例外処理

| 項目 | 内容 |
|---|---|
| ケース | 演習7-1と同様に「受注リスト」と「商品マスタ」がありますが、受注リストには **商品マスタに存在しない製品ID** が一部含まれています。上司から「商品名と単価を入れて、見つからないものは分かるようにしておいて」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、**商品名・単価を補完したうえで、マスタ未登録の行を識別できる状態**にしてください（例：商品名に「未登録」と表示、別列にフラグ列を追加 等）。関数名は指定せず、Copilotに手順・関数・確認ポイントを提案させて実行します。 |
| 提出物 | ① Copilotに入力した指示文<br />② 未登録データが判別できる状態になったExcelファイル |
| 留意点 | ・「未登録」を **どのように表現するか** が指示文で明確か<br />・未登録の判定基準（製品IDがマスタに存在しない）がぶれていないか<br />・未登録データが増えても運用できる形になっているか |

---

## 演習7-3　参照結果を前提条件に使う処理

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには **製品ID・数量** が入力されています。商品マスタには **製品ID・商品名・単価・販売区分（通常／廃番）** が管理されています。上司から「商品名と金額（数量×単価）を出して、**廃番の商品は金額を出さないようにして**」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、①製品IDをキーに商品名・単価・販売区分を取得 ②販売区分が「通常」の場合のみ金額（数量×単価）を算出し、「廃番」の場合は金額を空欄にしてください。**販売区分の取得結果を見ないと、金額計算の条件が確定しない構造**である点を意識して進めてください。 |
| 提出物 | ① Copilotに入力した指示文（複数回分）<br />② 要件を満たしたExcelファイル |
| 留意点 | ・販売区分の取得と金額計算を一体で雑に指示していないか<br />・「廃番」の場合に計算が実行されていないか<br />・条件判定と計算の順序が整理できているか |

---

## 演習7-4　中間結果を使った参照先の切り替え

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには **製品ID・数量** が入力されています。商品マスタには **製品ID・商品名・カテゴリID**、カテゴリマスタには **カテゴリID・標準単価** が管理されています。上司から「商品名と金額を出して。**金額はカテゴリごとの標準単価を使って**」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、①商品マスタから商品名とカテゴリIDを取得 ②取得したカテゴリIDを使ってカテゴリマスタから単価を取得 ③数量×単価で金額を算出してください。**単価の取得先が、最初の参照結果に依存する構造**である点を踏まえ、処理を段階的に整理することを目的とします。 |
| 提出物 | ① Copilotに入力した指示文<br />② 商品名・金額が算出されたExcelファイル |
| 留意点 | ・カテゴリID取得前に単価参照を指示していないか<br />・参照キーの流れ（製品ID → カテゴリID）が整理できているか<br />・中間列が必要かどうかを判断できているか |

---


# 演習7-5　参照＋並び替え＋上位抽出

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには 製品ID・数量 が入力されています。商品マスタには 製品ID・商品名・単価 が管理されています。上司から「**金額（数量×単価）が高い順に並べて、上位5件の商品がすぐ分かるようにして**」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、受注リストに金額情報を補完したうえで、金額を基準に上位5件の商品が一目で把握できる状態を作成してください。 |
| 提出物 | ① Copilotに入力した指示文<br />② 要件を満たしたExcelファイル |
| 留意点 | ・「金額」の定義（数量×単価）がぶれていないか<br />・上位件数（5件）が指示文で明確か<br />・並び替えと抽出の基準が混同されていないか |

---

# 演習7-6　複数条件をまたぐ例外処理

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには 製品ID・数量 が入力されています。商品マスタには 製品ID・商品名・単価・販売区分（通常／廃番）があります。上司から「商品名と金額（数量×単価）を出して。ただし、廃番は除外して、数量が0のものも分かるようにして」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、複数の条件が絡む状況でも、意図どおりの結果が得られる状態を作成してください。 |
| 提出物 | ① Copilotに入力した指示文<br />② 要件を満たしたExcelファイル |
| 留意点 | ・条件が増えても論理が破綻していないか<br />・「除外」と「表示」を混同していないか<br />・Copilotへの指示が段階的になっているか |

---


## 演習7-7　集計結果をもとにした行単位判定

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには **製品ID・売上金額** が入力されています。上司から「**全体平均より売上が高い明細が分かるようにして**」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、①売上金額列の平均値を算出 ②各行の売上金額が平均以上かどうかを判定する列を作成してください。**平均値という集計結果を先に確定させないと、行単位の判定式が書けない構造**である点を意識して進めてください。 |
| 提出物 | ① Copilotに入力した指示文<br />② 平均以上／未満が判別できるExcelファイル |
| 留意点 | ・平均値の算出範囲が一意に定義されているか<br />・平均値を直接式に埋め込んでいないか<br />・集計と判定の役割が分離できているか |

---

# 演習7-8　参照結果を使った条件付き集計

| 項目 | 内容 |
|---|---|
| ケース | 受注リストには 製品ID・数量・売上日 が入力されています。商品マスタには 製品ID・商品名・単価・販売区分（通常／廃番） が管理されています。上司から「廃番じゃない商品の売上金額だけを対象に、合計が分かるようにして」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、受注リストと商品マスタを参照しながら、条件に合致する売上のみを対象に集計結果を算出してください。 |
| 提出物 | ① Copilotに入力した指示文<br />② 要件を満たしたExcelファイル |
| 留意点 | ・「廃番を除外する」という条件が曖昧になっていないか<br />・集計対象の範囲がぶれていないか<br />・条件と集計を一文で雑に指示していないか |

---

# 演習7-9　日付条件＋マスタ参照＋判定列の作成


| 項目 | 内容 |
|---|---|
| ケース | 受注リストには 製品ID・数量・受注日 が入力されています。商品マスタには 製品ID・商品名・単価 が管理されています。上司から「今月分（2025年10月）の受注だけを対象に、金額を出して、高額なものが分かるようにして」と依頼されました。 |
| 演習内容 | 上司の依頼をCopilot向けに翻訳し、対象期間を限定したうえで金額を算出し、一定基準を超える行が判別できる状態を作成してください。 |
| 提出物 | ① Copilotに入力した指示文<br />② 要件を満たしたExcelファイル |
| 留意点 | ・「今月」の定義が曖昧になっていないか<br />・判定基準が途中で変わっていないか<br />・計算と判定の役割が混ざっていないか |

---



## この章でできるようになること

- 上司の依頼を **AIが実行できる業務指示に翻訳**できる  
- マスタ参照を **関数暗記なしで実装**できる  
- 例外処理・複数参照・計算列追加まで **一人で完結**できる  
