# 繰り返し（ループ）

### 1. はじめに：繰り返し処理とは？

プログラムを書いていると、「同じような処理を何回も繰り返したい」という場面によく遭遇します。  
例えば、1から100までの数字を順に表示したい、リストに入っているすべてのデータに対して何か処理をしたい、といった場合です。

このような「繰り返し」を行うための構文を**繰り返し処理**、または**ループ**と呼びます。  
ループを使うことで、同じコードを何度も書く手間が省け、コードが簡潔になり、間違いも減ります。

Javaには主に以下の4種類のループがあります。

1.  **`for` ループ**: 繰り返し回数が決まっている場合に主に使用されます。
2.  **`while` ループ**: 特定の条件が真（true）である間、繰り返し処理を行います。  
    繰り返し回数が事前に分からない場合に主に使用されます。
3.  **`do-while` ループ**: `while` ループと似ていますが、条件の判定が処理の実行後に行われるため、最低1回は必ず実行されます。
4.  **拡張 `for` ループ (for-each)**: 配列やコレクション（リストなど）の要素を一つずつ順番に取り出して処理する場合に、より簡潔に記述できます。

それでは、それぞれのループについて詳しく見ていきましょう。

---

### 2. 各ループの解説とサンプルコード

以下のサンプルコードは、すべて一つのJavaファイルに記述されています。

```java showLineNumbers
public class LoopExamples {

    public static void main(String[] args) {

        System.out.println("--- Java 繰り返し処理の例 ---");

        // --- 1. for ループ ---
        System.out.println("\n--- 1. for ループ ---");

        // 例: 1から5までの数字を表示
        for (int i = 1; i <= 5; i++) {
            System.out.println("forループ: 現在のカウント -> " + i);
        }
        System.out.println("forループ終了。\n");

        // --- 2. while ループ ---
        System.out.println("--- 2. while ループ ---");

        // 例: 3からカウントダウン
        int count = 3;
        while (count > 0) {
            System.out.println("whileループ: カウントダウン -> " + count);
            count--; // count の値を減らして、いつか条件がfalseになるようにする
        }
        System.out.println("whileループ終了。\n");

        // --- 3. do-while ループ ---
        System.out.println("--- 3. do-while ループ ---");

        // 例: 初回は必ず実行され、その後条件を判定
        int value = 0;
        do {
            System.out.println("do-whileループ: 実行されました。現在の値 -> " + value);
            value++;
        } while (value < 1); // 条件が最初からfalseでも、1回は実行される
        System.out.println("do-whileループ終了。\n");


        // --- 4. 拡張 for ループ (for-each) ---
        System.out.println("--- 4. 拡張 for ループ (for-each) ---");

        // 例1: 文字列の配列
        String[] fruits = {"Apple", "Banana", "Cherry"};
        System.out.println("  - 配列の例:");
        for (String fruit : fruits) {
            System.out.println("拡張forループ: フルーツ -> " + fruit);
        }

        // 例2: 整数のリスト (java.util.List を使用)
        java.util.List<Integer> numbers = new java.util.ArrayList<>();
        numbers.add(10);
        numbers.add(20);
        numbers.add(30);
        System.out.println("  - リストの例:");
        for (int num : numbers) {
            System.out.println("拡張forループ: 数値 -> " + num);
        }
        System.out.println("拡張forループ終了。\n");


        // --- 5. ループの制御 (break と continue) ---
        System.out.println("--- 5. ループの制御 (break と continue) ---");

        // 例1: break (ループを途中で抜ける)
        System.out.println("  - break の例 (6になったらループを終了):");
        for (int i = 1; i <= 10; i++) {
            if (i == 6) {
                System.out.println("    --> 6になったのでループを終了します (break)");
                break; // このbreakが実行されると、forループ全体が終了する
            }
            System.out.println("    現在の数値 (breakの例): " + i);
        }
        System.out.println("  breakの例終了。\n");

        // 例2: continue (現在の繰り返し処理をスキップし、次の繰り返しへ進む)
        System.out.println("  - continue の例 (偶数をスキップして奇数のみ表示):");
        for (int i = 1; i <= 5; i++) {
            if (i % 2 == 0) { // もし i が偶数なら
                System.out.println("    --> " + i + " は偶数なのでスキップします (continue)");
                continue; // このcontinueが実行されると、現在のイテレーションの残りの処理をスキップし、次のイテレーションへ移る
            }
            System.out.println("    現在の数値 (continueの例, 奇数のみ表示): " + i);
        }
        System.out.println("  continueの例終了。\n");
    }
}
```

---

### 2.1. `for` ループの詳細

`for` ループは、繰り返し回数が明確に決まっている場合に最もよく使われるループです。  
その構文は、初期化、条件式、更新式という3つの要素を1行で指定する点が特徴です。  

**構文:**  
```java showLineNumbers
for (初期化; 条件式; 更新式) {
    // 繰り返し処理（ループボディ）
}
```

**各要素の役割と実行順序:**  

| 要素名   | 説明                                                                                | 実行タイミング                                        |
| :------- | :---------------------------------------------------------------------------------- | :---------------------------------------------------- |
| `初期化` | ループが開始される前に一度だけ実行されます。  通常、カウンタ変数の宣言と初期化を行います。 | ループ開始時、一番最初に一度だけ。                  |
| `条件式` | ループを続けるかどうかを判定する式です。  この式が`true`である間、ループボディが実行されます。 | ループボディが実行される前と、各イテレーション（繰り返し）の更新式の後に毎回。 |
| `更新式` | ループボディが実行された後に毎回実行されます。  通常、カウンタ変数の値を増減させます。     | 各イテレーションのループボディ実行後、条件式評価の前。 |

**`for` ループの実行の流れ:**  
1.  **初期化**が一度だけ実行されます。  
2.  **条件式**が評価されます。  
3.  もし**条件式**が`true`であれば、ループボディ（`{}`内の処理）が実行されます。  
4.  ループボディの実行後、**更新式**が実行されます。  
5.  再び**条件式**が評価され、3〜4の手順が繰り返されます。  
6.  もし**条件式**が`false`であれば、ループは終了し、`for`ループの次の行へ処理が移ります。  

**サンプルコード:**  
```java showLineNumbers
        // 例: 1から5までの数字を表示
        for (int i = 1; i <= 5; i++) {
            System.out.println("forループ: 現在のカウント -> " + i);
        }
        System.out.println("forループ終了。\n");
```
**解説:**  
*   `for (int i = 1; i <= 5; i++)`:  
    *   `int i = 1;`: ループが始まる前に、整数型の変数`i`を宣言し、`1`で初期化します。これがカウンタ変数となります。  
    *   `i <= 5;`: ループを続ける条件です。`i`の値が`5`以下の間は、ループボディが実行され続けます。  
    *   `i++`: ループボディが1回実行された後、`i`の値を1増やします（インクリメント）。  
*   `System.out.println("forループ: 現在のカウント -> " + i);`: ループが1回実行されるごとに、現在の`i`の値を表示します。  

このループは、`i`が1から始まり、5になるまで（`i=1, 2, 3, 4, 5`）合計5回繰り返され、それぞれの`i`の値が表示されます。  

---

### 2.2. `while` ループの詳細

`while` ループは、特定の条件が`true`である間、繰り返し処理を実行するループです。  
繰り返し回数が事前に分からない場合や、ある条件が満たされるまで処理を続けたい場合に適しています。  

**構文:**  
```java showLineNumbers
while (条件式) {
    // 繰り返し処理（ループボディ）
}
```

**`while` ループの実行の流れ:**  
1.  まず**条件式**が評価されます。  
2.  もし**条件式**が`true`であれば、ループボディ（`{}`内の処理）が実行されます。  
3.  ループボディの実行後、再び**条件式**が評価され、2の手順が繰り返されます。  
4.  もし**条件式**が`false`であれば、ループは終了し、`while`ループの次の行へ処理が移ります。  

:::danger
#### 無限ループ
`while`ループ内で条件式が常に`true`になるような状況（条件を変える処理を書き忘れるなど）が発生すると、ループが永遠に終了しなくなることがあります。これを**無限ループ**と呼び、プログラムが応答しなくなる原因となります。  
必ず、ループボディ内で条件式を`false`にするための処理（例: カウンタ変数の増減、フラグの変更など）を記述するようにしましょう。  
:::

**サンプルコード:**  
```java showLineNumbers
        // 例: 3からカウントダウン
        int count = 3;
        while (count > 0) {
            System.out.println("whileループ: カウントダウン -> " + count);
            count--; // count の値を減らして、いつか条件がfalseになるようにする
        }
        System.out.println("whileループ終了。\n");
```
**解説:**  
*   `int count = 3;`: ループの外部でカウンタ変数`count`を`3`で初期化します。  
*   `while (count > 0)`: `count`が`0`より大きい間はループを続行する条件です。  
*   `System.out.println("whileループ: カウントダウン -> " + count);`: 現在の`count`の値を表示します。  
*   `count--;`: `count`の値を1減らします。この行がないと、`count`は常に`3`のままで条件`count > 0`が`true`になり続け、無限ループに陥ります。  

このループは、`count`が3、2、1のときに実行され、`count`が0になった時点で条件`count > 0`が`false`となり、ループが終了します。  

---

### 2.3. `do-while` ループの詳細

`do-while` ループは、`while`ループに似ていますが、条件の判定が処理の実行後に行われる点が異なります。  
このため、**ループボディの処理が最低1回は必ず実行される**という特徴があります。  

**構文:**  
```java showLineNumbers
do {
    // 繰り返し処理（ループボディ）
} while (条件式); // セミコロンが必要です
```

**`do-while` ループの実行の流れ:**  
1.  まず、無条件でループボディ（`{}`内の処理）が実行されます。  
2.  ループボディの実行後、**条件式**が評価されます。  
3.  もし**条件式**が`true`であれば、1の手順に戻り、ループボディが再び実行されます。  
4.  もし**条件式**が`false`であれば、ループは終了し、`do-while`ループの次の行へ処理が移ります。  

**利用例:**  
ユーザーに何らかの入力を促す場合など、初回は必ず入力処理を実行し、その後の入力内容によって繰り返しが必要かどうかを判断するような場面でよく使われます。  

**サンプルコード:**  
```java showLineNumbers
        // 例: 初回は必ず実行され、その後条件を判定
        int value = 0;
        do {
            System.out.println("do-whileループ: 実行されました。現在の値 -> " + value);
            value++;
        } while (value < 1); // 条件が最初からfalseでも、1回は実行される
        System.out.println("do-whileループ終了。\n");
```
**解説:**  
*   `int value = 0;`: 変数`value`を`0`で初期化します。  
*   `do { ... }`: まずこの`do`ブロック内の処理が無条件で実行されます。  
    *   `System.out.println("do-whileループ: 実行されました。現在の値 -> " + value);`: 現在の`value`の値を表示します。`value`は`0`なので「現在の値 -> 0」と表示されます。  
    *   `value++;`: `value`の値を1増やします。この時点で`value`は`1`になります。  
*   `while (value < 1);`: `do`ブロックの処理が終わった後、この条件式が評価されます。  
    *   この時点では`value`は`1`なので、`1 < 1`は`false`となります。  
    *   条件が`false`なので、ループは終了し、次の行へ進みます。  

この例では、条件式`value < 1`が最初から`false`になる設定ですが、`do`ブロック内の処理が1回だけ実行されることを確認できます。  

---

### 2.4. 拡張 `for` ループ (for-each) の詳細

拡張 `for` ループ（またはfor-eachループ）は、配列や`java.util.Collection`インタフェースを実装したクラス（`List`, `Set`など）の要素を一つずつ順番に取り出して処理する場合に、より簡潔に記述するための構文です。  
各要素のインデックス（添字）を意識することなく、要素そのものにアクセスできるため、コードが読みやすくなります。  

**構文:**  
```java showLineNumbers
for (要素の型 変数名 : 配列やコレクション) {
    // 繰り返し処理（ループボディ）
}
```

**実行の流れ:**  
1.  指定された配列やコレクションの最初の要素から順に、変数に代入されます。  
2.  変数に代入された要素に対してループボディが実行されます。  
3.  すべての要素が処理されるまで、1〜2の手順が繰り返されます。  

:::caution
#### 制約  
*   要素のインデックス（例: 配列の`[0]`, `[1]`など）にアクセスすることはできません。  
*   ループ中にコレクションの要素を追加・削除するなど、構造を変更すると`ConcurrentModificationException`が発生する可能性があります（一般的なループでは推奨されません）。  
*   配列やコレクションを逆順に処理することはできません。常に先頭から順に処理されます。  
:::

**サンプルコード:**  
```java showLineNumbers
        // 例1: 文字列の配列
        String[] fruits = {"Apple", "Banana", "Cherry"};
        System.out.println("  - 配列の例:");
        for (String fruit : fruits) {
            System.out.println("拡張forループ: フルーツ -> " + fruit);
        }

        // 例2: 整数のリスト (java.util.List を使用)
        java.util.List<Integer> numbers = new java.util.ArrayList<>();
        numbers.add(10);
        numbers.add(20);
        numbers.add(30);
        System.out.println("  - リストの例:");
        for (int num : numbers) {
            System.out.println("拡張forループ: 数値 -> " + num);
        }
        System.out.println("拡張forループ終了。\n");
```
**解説:**  
*   **例1: 文字列の配列**  
    *   `String[] fruits = {"Apple", "Banana", "Cherry"};`: `String`型の配列`fruits`を初期化します。  
    *   `for (String fruit : fruits)`: この行が拡張`for`ループの宣言です。  
        *   `String fruit`: `fruits`配列から取り出される各要素の型（`String`）と、その要素が一時的に格納される変数名（`fruit`）を指定します。  
        *   `: fruits`: 処理対象となる配列（`fruits`）を指定します。  
    *   ループが1回実行されるごとに、`fruit`変数には「Apple」、「Banana」、「Cherry」が順に代入され、それぞれの値が表示されます。  

*   **例2: 整数のリスト**  
    *   `java.util.List<Integer> numbers = new java.util.ArrayList<>();`: `java.util.List`はJavaのコレクションフレームワークの一部で、可変長の要素を扱えるリストです。`ArrayList`はその具体的な実装クラスです。  
        *   `<Integer>`はジェネリクスと呼ばれ、このリストが`Integer`型（整数のオブジェクト型）の要素を格納することを示します。  
        *   コード上では`java.util.List`と完全修飾名で記述していますが、通常はファイルの先頭に`import java.util.List;`と`import java.util.ArrayList;`を記述して、`List<Integer> numbers = new ArrayList<>();`と省略して記述します。  
    *   `numbers.add(10); numbers.add(20); numbers.add(30);`: リストに要素を追加します。  
    *   `for (int num : numbers)`: `numbers`リストから`int`型の要素を順に取り出し、変数`num`に代入します。  
        *   リストの要素は`Integer`型ですが、オートアンボクシング（自動変換）により`int`型で受け取ることができます。  
    *   このループも同様に、`num`変数に「10」、「20」、「30」が順に代入され、それぞれの値が表示されます。  

---

### 2.5. ループの制御 (`break` と `continue`) の詳細

ループの実行中に、通常とは異なる方法でループの流れを制御したい場合があります。  
そのような時に役立つのが、`break`文と`continue`文です。  

**`break` 文:**  
`break`文は、実行中の**最も内側のループを完全に終了させ、ループの次の行に処理を移します。**  
条件を満たした場合に、途中でループを抜け出したいときに使用します。  

**サンプルコード:**  
```java showLineNumbers
        // 例1: break (ループを途中で抜ける)
        System.out.println("  - break の例 (6になったらループを終了):");
        for (int i = 1; i <= 10; i++) {
            if (i == 6) {
                System.out.println("    --> 6になったのでループを終了します (break)");
                break; // このbreakが実行されると、forループ全体が終了する
            }
            System.out.println("    現在の数値 (breakの例): " + i);
        }
        System.out.println("  breakの例終了。\n");
```
**解説:**  
*   この`for`ループは、`i`が1から10まで繰り返すように見えますが、`if (i == 6)`という条件があります。  
*   `i`が1, 2, 3, 4, 5のときは条件が`false`なので、`if`ブロックはスキップされ、`System.out.println("現在の数値..." + i);`が実行されます。  
*   `i`が`6`になったとき、`if (i == 6)`の条件が`true`になります。  
*   `System.out.println("--> 6になったのでループを終了します (break)");`が表示された後、`break;`が実行されます。  
*   `break;`が実行されると、この`for`ループは即座に終了し、`for`ループの次の行（`System.out.println("breakの例終了。\n");`）へ処理が移ります。  
*   結果として、`i`が6以降の値（7, 8, 9, 10）は表示されません。  

**`continue` 文:**  
`continue`文は、実行中の**現在のイテレーション（繰り返し）をスキップし、ループの次のイテレーションへ処理を移します。**  
現在の繰り返しの一部だけをスキップしたいときに使用します。  

**サンプルコード:**  
```java showLineNumbers
        // 例2: continue (現在の繰り返し処理をスキップし、次の繰り返しへ進む)
        System.out.println("  - continue の例 (偶数をスキップして奇数のみ表示):");
        for (int i = 1; i <= 5; i++) {
            if (i % 2 == 0) { // もし i が偶数なら
                System.out.println("    --> " + i + " は偶数なのでスキップします (continue)");
                continue; // このcontinueが実行されると、現在のイテレーションの残りの処理をスキップし、次のイテレーションへ移る
            }
            System.out.println("    現在の数値 (continueの例, 奇数のみ表示): " + i);
        }
        System.out.println("  continueの例終了。\n");
```
**解説:**  
*   この`for`ループは、`i`が1から5まで繰り返します。  
*   `if (i % 2 == 0)`: `i`が偶数かどうかを判定する条件です。`%`は剰余演算子で、割り算の余りを計算します。`i % 2 == 0`は、「`i`を2で割った余りが0、つまり`i`が偶数である」ことを意味します。  
*   `i`が1のとき: `1 % 2 == 0`は`false`なので、`if`ブロックはスキップされ、「現在の数値...1」が表示されます。  
*   `i`が2のとき: `2 % 2 == 0`は`true`なので、`if`ブロックに入ります。「--> 2 は偶数なのでスキップします (continue)」が表示された後、`continue;`が実行されます。  
    *   `continue;`が実行されると、現在のイテレーション（`i=2`の回）の残りの処理（`System.out.println("現在の数値..." ...);`）はスキップされ、`i`がインクリメントされ（`i=3`）、次のイテレーションに移ります。  
*   `i`が3のとき: `3 % 2 == 0`は`false`なので、「現在の数値...3」が表示されます。  
*   `i`が4のとき: `4 % 2 == 0`は`true`なので、`continue;`が実行され、残りの処理はスキップされます。  
*   `i`が5のとき: `5 % 2 == 0`は`false`なので、「現在の数値...5」が表示されます。  
*   結果として、`i`が偶数（2と4）のときの表示はスキップされ、奇数（1, 3, 5）のみが表示されます。  

---

### 4. ループの使い分け

それぞれのループには得意な状況があります。  
適切なループを選ぶことで、コードの可読性と保守性が向上します。  

| ループの種類           | 主な用途（いつ使うか）                                   | 特徴                                                                    |
| :------------------- | :------------------------------------------------------- | :---------------------------------------------------------------------- |
| **`for` ループ**     | - 繰り返し回数が**事前に分かっている**場合。             <br /> - カウンタ変数を使って、決められた範囲で処理を繰り返したい場合。 | - 初期化、条件、更新を1行で記述でき、コードがコンパクト。          <br /> - インデックスを使った複雑な処理に適している。 |
| **`while` ループ**   | - 繰り返し回数が**事前に分からない**が、特定の条件が満たされるまで繰り返したい場合。 <br /> - 例: ユーザー入力が特定の値になるまで、ファイル終端までなど。 | - シンプルな条件式で繰り返しを制御する。                            <br /> - 無限ループにならないよう、条件を変更する処理が必須。 |
| **`do-while` ループ** | - **最低1回は必ず処理を実行し**、その後条件を判定したい場合。 <br /> - 例: ユーザーに一度は入力を促し、入力内容が正しいかチェックして、不正なら再度入力を促す。 | - 初回の実行を保証したい場合に便利。                                |
| **拡張 `for` ループ** <br /> **(`for-each`)** | - 配列やコレクションの**全要素を順番に処理したい**場合。 <br /> - 要素のインデックス（添字）が不要で、要素そのものにアクセスできれば良い場合。 | - コードがより簡潔で読みやすい。                                    <br /> - インデックスによる制御や要素の変更には不向き。 |

### 5. まとめ

繰り返し処理は、プログラムの効率性と可読性を高めるための必須機能です。  
それぞれのループの特徴と使い分けを理解し、適切な場面で活用できるようになりましょう。  
