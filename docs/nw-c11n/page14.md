---
sidebar_position: 14
---

# 13. WAN・QoS・IPv6

<details>
    <summary>概要</summary>
    <div>


## WAN接続の基本モデル

WAN接続は、主に**専用回線**か**共有回線**のどちらを利用するかで分類されます。

### ① 専用回線

  * **特徴:** 通信事業者の回線を**一対一で占有**する、最も信頼性の高い接続方法。帯域が保証されます。
  * **メリット:** 非常に安定しており、セキュリティが高い。
  * **デメリット:** **コストが非常に高い**。

### ② 共有回線

  * **特徴:** 通信事業者が持つネットワークを複数の顧客で共有し、**必要な分だけ利用**する接続方法。
  * **メリット:** 専用線より**低コスト**で、トラフィックの変動に合わせて柔軟に帯域を利用できます。
  * **代表技術:** **MPLS**などがこれに該当します。

-----

## 現在の主流なWANテクノロジー

| 技術 | 概要と目的 | 特徴 (CCNA重要ポイント) |
| :--- | :--- | :--- |
| **MPLS**<br />(Multi-Protocol Label Switching) | **大規模WANの中心技術**。パケットに**ラベル**（タグ）を付与し、ルーティングテーブルを参照する代わりにラベルに基づいて高速に転送します。 | **高速な転送**と、**QoS**（通信の品質保証）の制御が容易。現在、大企業の拠点間接続やISPのバックボーンで広く利用されています。 |
| 広域イーサネット<br />(E-VPN) | LAN技術のWANへの拡張。イーサネット（L2）のフレームをそのまま通信事業者のWAN経由で転送します。 | ユーザー側はLANと同じ設定（VLAN）でWANを利用でき、シンプルで高速。 |
| インターネットVPN<br />(IPsec/SSL VPN) | 公衆インターネットを経由し、VPN（仮想専用線）を構築。 | コストが最も低い。セキュリティのためにIPsecやSSLで暗号化・トンネリング（カプセル化）を行い、セキュリティを確保します。 |

:::tip MPLSの仕組み
MPLSは、従来のルーティング（IPアドレスを見る）よりも高速です。  
ルーターは最初の1回だけIPアドレスをチェックし、**ラベル**を付けて次の機器に渡します。  
以降の機器はIPアドレスを見ずラベルに従って転送するため、処理が非常に迅速です。
:::
-----

### VPNの主要な目的

1.  **機密性の確保**（暗号化）: 通信内容が第三者に盗聴されるのを防ぎます。
2.  **完全性の保証**（改ざん防止）: 通信内容が途中で改ざんされていないことを保証します。
3.  **認証**: 通信相手が正しい当事者であることを確認します。

### VPNの種類

| 種類 | 目的 | 主な利用シーン |
| :--- | :--- | :--- |
| **サイト間VPN**<br />(Site-to-Site VPN) | 企業などの**拠点間**のネットワークを相互接続する。 | 本社と支社間でのLAN接続。 |
| **リモートアクセスVPN**<br />(Remote Access VPN) | 社外の**個人ユーザー**（出張者、在宅勤務者）が社内ネットワークに安全にアクセスする。 | 自宅のPCから会社のサーバーへアクセス。 |

-----

## IPsec (Internet Protocol Security)

**IPsec**は、VPNを実現するための**最も標準的かつ強固なセキュリティプロトコル群**です。  
IPsecは、**レイヤ3**（IP層）で動作し、IPパケット全体を保護します。

### IPsecの主要な構成要素

IPsecは、セキュリティを確保するために以下の2つのプロトコルを使用します。

#### ① AH (Authentication Header)

  * **目的:** **認証**と**完全性の保証**を提供します。
  * **機能:** パケットの改ざんを防ぎ、送信元が正しいことを確認します。
  * **注意点:** データ自体の**暗号化は行いません**。

#### ② ESP (Encapsulating Security Payload)

  * **目的:** **機密性の確保**（暗号化）、**認証**、**完全性の保証**を提供します。
  * **機能:** パケットのペイロード（データ本体）を暗号化し、盗聴を防止します。
  * **重要性:** **IPsecの最も一般的なプロトコル**であり、通常、VPNではESPを使用して通信全体のセキュリティを確保します。

### IPsecの動作モード

IPsecには、パケットをどのようにカプセル化（包み込む）かによって2つのモードがあります。

| モード | カプセル化の範囲 | 主な利用シーン |
| :--- | :--- | :--- |
| **トランスポートモード**<br />(Transport Mode) | **パケットのペイロード（データ）のみ**を保護。 | エンドツーエンドの保護（ホスト間通信）。 |
| **トンネルモード**<br />(Tunnel Mode) | **IPパケット全体**を保護し、新しいIPヘッダを付与。 | **ゲートウェイ間のVPN**（サイト間VPN）。外部からの攻撃に対する防御壁として機能。 |

　
<iframe src="https://drive.google.com/file/d/1necDcQUSgvjZ0ZcGscRClkpF2d1aXr_l/preview" width="640" height="360" allow="fullscreen"></iframe>
　
## QoS（Quality of Service）

QoSとは、ネットワーク上で流れるトラフィック（通信）に対して、**種類や重要度に応じて優先順位を付け、品質を制御・保証する**ための技術です。

### QoSが必要な理由

ネットワーク回線容量以上のデータが集中する状態を**輻輳**（ふくそう）と呼びます。  
輻輳が発生すると以下の問題が発生し、特に音声や動画の品質が致命的に低下します。

  * **遅延** (Delay): データが目的地に届くまでの時間の増加。
  * **ジッタ** (Jitter): データ到着時間のバラつきの増加（音声が途切れる原因）。
  * **パケットロス* (Packet Loss): 処理しきれないデータが破棄されること。

-----

## QoSの動作手順（4つのメカニズム）

QoSは通常以下の手順で動作し、トラフィックを制御します。

### ① 分類とマーキング (Classification & Marking)

ネットワーク機器がトラフィックを受信した際、それが音声なのか、Webデータなのか、ファイル転送なのかを識別します。

  * 識別後、パケットのヘッダ領域にある専用フィールドに重要度を示す目印（マーク）を付けます。

#### 主要なマーキング技術

| 技術 | レイヤ | フィールド | 特徴 |
| :--- | :--- | :--- | :--- |
| **CoS**<br />(Class of Service) | L2（イーサネット） | 3ビット | スイッチングネットワーク内で使用される。 |
| **DSCP**<br />(Differentiated Services Code Point) | L3（IPヘッダ） | **6ビット** | **現在の標準的なマーキング技術**。ネットワーク全体（エンドツーエンド）で使用可能。 |

### ② 輻輳管理（キューイング）

ルーターやスイッチが輻輳状態になった場合、パケットを廃棄する前に**キュー**（待ち行列）に入れます。

  * QoSでは、パケットのマーキングに基づき複数のキューに分けて管理し、優先度の高いキューから先に処理を行います。

### ③ 輻輳回避（Congestion Avoidance）

輻輳が起きる**前**に重要度の低いトラフィックを意図的に破棄することで、重要なトラフィックのための帯域を確保します。

### ④ シェーピングとポリシング（帯域制御）

トラフィックがネットワークに入る**前**に帯域を制御します。

  * **ポリシング** (Policing): 設定された帯域を超過したトラフィックを**即座に破棄**または**優先度を下げる**（トラフィックを厳しく監視）。
  * **シェーピング** (Shaping): 超過したトラフィックを**一時的にキューに保持**し、後でゆっくりと送信する（バーストトラフィックの平滑化）。
　
<iframe src="https://drive.google.com/file/d/1I3ylJW_zL7GiGFQ5PwQDkDTDmjmCeYRc/preview" width="640" height="360" allow="fullscreen"></iframe>
　
## IPv6の概要と目的

IPv6は、現在主流のIPv4（32ビット）が抱えるアドレスの枯渇問題を根本的に解決するために設計されました。

  * **IPv4アドレス:** $2^{32}$個（約43億個）
  * **IPv6アドレス:** **128ビット**（約 $3.4 ✕ 10^{38}$ 個）
      * これは事実上無限のアドレス空間を提供します。

-----

## アドレス構造と表記法

IPv4とは異なり、IPv6アドレスは**16進数**で表記され、その構造は以下の通りです。

### 構造

  * **128ビット**を**16ビットずつ8つのブロック**に分け、コロン（:）で区切って表記します。

### 表記の省略規則 (重要)

IPv6アドレスは非常に長いため、以下のルールで省略できます。

1.  **先頭のゼロの省略:** 各ブロックの先頭にあるゼロは省略できます。
      * 例: `000A:0B00:` → `A:B00:`
2.  **連続するゼロの省略 (::):** ゼロのブロックが連続する場合、一度だけ**二重コロン `::`** でまとめて省略できます。
      * 例: `2001:0DB8:0000:0000:0000:0000:1428:57AB`
      * 省略後: `2001:DB8::1428:57AB`

-----

## IPv6アドレスの種類

IPv6は、IPv4にあった「ブロードキャスト」を廃止し、より効率的な通信方式を採用しています。

| 種類 | 定義 | 役割と特徴 | IPv4との比較 |
| :--- | :--- | :--- | :--- |
| **ユニキャスト**<br />(Unicast) | **1対1**の通信 | 特定のインターフェースを一意に識別する。 | IPv4のユニキャストに相当。 |
| **マルチキャスト**<br />(Multicast) | **1対多**の通信 | 特定のグループに属するすべてのデバイスにパケットを送信する。 | **IPv4のブロードキャストの代替**。 |
| **エニーキャスト**<br />(Anycast) | **1対近接**の通信 | 複数のデバイスに同じアドレスを設定し、そのうち**最もネットワーク的に近い1台**にパケットを送信する。 | IPv6で新しく登場した概念。 |

### IPv4との最大の違い：ブロードキャストの廃止

IPv6では、ネットワーク全体にデータをばらまく**ブロードキャスト**は使われません。  
代わりに、マルチキャストがその役割を担います。

-----

## アドレスの構成と自動設定

IPv6アドレスは、前半の**ネットワーク部**と、後半の**インターフェースID**（ホスト部）に分けられます。

### グローバルユニキャストアドレスの構造

| ネットワーク部 (64ビット) | ホスト部 (64ビット) |
| :---: | :---: |
| プレフィックスとサブネットID | インターフェースID（MACアドレスなどを基に生成） |

### EUI-64 (Extended Unique Identifier 64)

クライアント端末は、ルーターからの通知と、自身の**MACアドレス**を利用してインターフェースID（ホスト部）を自動で決定できます。このMACアドレスを基に64ビットのインターフェースIDを生成する仕組みを**EUI-64**と呼びます。

これにより、DHCPサーバーを必須とせず、アドレスの自動設定（SLAAC: Stateless Address Autoconfiguration）が容易になりました。
　
<iframe src="https://drive.google.com/file/d/1btTg_wFWnage_g-DfMg_tWGApXEfOXL9/preview" width="640" height="360" allow="fullscreen"></iframe>

　

    </div>
</details>

<details>
    <summary>確認問題</summary>
    <div>
以下のファイルをダウンロードし、回答を記入して担当講師に送信して下さい。

[**確認問題**](./files/14.WAN・QoS・IPv6_確認課題_名前.xlsx)
    </div>
</details>