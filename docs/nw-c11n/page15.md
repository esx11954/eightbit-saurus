---
sidebar_position: 15
---

# 14. セキュリティ

<details>
    <summary>概要</summary>
    <div>

## 管理アクセス

ネットワーク機器を外部から設定・監視するための接続方法には、セキュリティレベルによって大きな違いがあります。

| 接続方法 | プロトコル | セキュリティ | 特徴 |
| :--- | :--- | :--- | :--- |
| **安全な方法** | **SSH** (Secure Shell) | **高** | 通信内容を**暗号化**するため、パスワードやコマンドが盗聴されるリスクがない。**管理アクセスに必須**。 |
| **危険な方法** | **Telnet** | **低** | 通信内容が**平文**（暗号化なし）で流れるため、盗聴されるリスクがある。現在は使用非推奨。 |

### ⌨️ SSHの有効化（CCNA必須コマンド）

安全なリモート接続を確保するため、SSHを有効化します。

```cli
Switch(config)# hostname MySwitch
Switch(config)# ip domain-name zeroone-dojo.local  // ドメイン名を設定
Switch(config)# crypto key generate rsa             // RSAキーを生成
Switch(config)# line vty 0 4
Switch(config-line)# transport input ssh           // VTYポートにSSHのみ許可
```

-----

## セキュリティ管理の三本柱：AAA

企業などの大規模なネットワークでは、機器へのアクセス管理を**AAA**（トリプルエー）という3つの機能で厳密に行います。

| 機能 | 英語名 | 目的 | 役割 |
| :--- | :--- | :--- | :--- |
| **認証** | **Authentication** | **誰であるか？** | IDとパスワードや証明書などにより、接続要求者が本人であることを確認する。 |
| **認可** | **Authorization** | **何ができるか？** | 認証されたユーザーが、**どこまでの操作権限**を持つかを決定する（例: 監視のみ許可、設定変更は拒否）。 |
| **アカウンティング** | **Accounting** | **何をしたか？** | ユーザーがネットワーク上で**いつ、何を行ったか**、その操作履歴やトラフィック量などを記録する。 |

-----

## AAA：集中管理の仕組み

### 認証サーバーの役割
AAAの機能をネットワーク内の全機器で一元管理するために、専用のサーバーとプロトコルを使用します。
アクセスポイントやルーターは、ユーザーからの接続要求を直接処理せず、これらの認証サーバーに問い合わせて、**認証**、**認可**、**アカウンティング**の全てを一括で処理させます。

| プロトコル | 特徴 | 主な用途 |
| :--- | :--- | :--- |
| **RADIUS** | 業界標準規格。**認証**と**認可**の機能は一つにまとめられることが多い。 | **ワイヤレスLAN**や**VPN**などのユーザー認証。 |
| **TACACS+** | Cisco独自規格。**認証**、**認可**、**アカウンティング**を完全に分離して詳細な制御が可能。 | **ネットワーク機器の管理アクセス**（ルーター、スイッチ）の制御に優れる。 |

### ローカル認証とパスワードの保護

外部サーバーがダウンした場合に備え、機器には必ず**ローカルアカウント**を設定します。また、パスワードは必ず暗号化します。

```cli
Switch(config)# username admin privilege 15 secret Ciscopass! // ローカルユーザー作成
Switch(config)# enable secret YourStrongPassword // 特権EXECモードのパスワード設定
Switch(config)# service password-encryption // 設定ファイル内のパスワードを暗号化
```

---

## ネットワーク防御の最前線：IDS/IPS

ネットワークに侵入しようとする攻撃や不正な通信を検知・防御するためのシステムです。

| システム | 役割 | 動作 |
| :--- | :--- | :--- |
| **IDS** (Intrusion Detection System) | **侵入検知** | 不正な通信を検知した際に**管理者に通知**する。 |
| **IPS** (Intrusion Prevention System) | **侵入防止** | 不正な通信を検知した際に、**能動的・自動的にその通信を遮断**する。 |

:::tip ポイント
 IPSは通信経路の途中に配置され、悪意のあるパケットが目的のホストに到達する**前**にそれを破棄したり接続を切断したりする、**防御の中核**を担います。
:::

---

## 主要なセキュリティ脅威：スプーフィングとDDoS

### ① スプーフィング (Spoofing：なりすまし)
正規のユーザーや機器になりすまして、不正なアクセスや通信を行う攻撃の総称です。

| 種類 | 標的 | 攻撃の仕組み |
| :--- | :--- | :--- |
| **IPスプーフィング** | **IPアドレス** | パケットの送信元IPアドレスを偽装し、システムをだます。主にDDoS攻撃などに利用される。 |
| **ARPスプーフィング** | **MACアドレス** | ARPプロトコルを悪用し、特定のIPアドレスに対するMACアドレスを偽装。通信を中継して**盗聴**する（中間者攻撃）。 |
| **DNSスプーフィング** | **DNSサーバー** | 偽の応答を送り付け、ユーザーを偽のサーバー（フィッシングサイトなど）に誘導する。 |

### ② DDoS (Distributed Denial of Service)
**分散型サービス妨害攻撃**。  
世界中に分散した多数のコンピュータから特定のサーバーに対して同時に大量のアクセスやデータを送りつけ、サーバーや回線をダウンさせ、サービスを停止に追い込みます。

---

## 対策の統合と多層防御

現代のネットワークセキュリティは、特定の技術一つに頼るのではなく、複数の技術を組み合わせた**多層防御**（Defense in Depth）によって実現されます。

1.  **境界防御**（ファイアウォール、IPS）: 外部からの不正なアクセスや、既知の攻撃パターン（IPS）をネットワークの入口で阻止します。
2.  **管理アクセス**（AAA）: 機器へのアクセス者を**認証**（SSH, RADIUS）し、その権限を制限（認可）し、操作を記録（アカウンティング）することで、内部からの不正操作を防ぎます。
3.  **データ保護**（VPN）: 通信が必要な場合は、**IPsec VPN**などで暗号化を施し、盗聴や改ざんのリスクを排除します。
4.  **L2制御**（DHCPスヌーピングなど）: スプーフィング攻撃を防止するため、スイッチレベルでDHCPパケットやARPパケットの正当性を検証する機能を有効化します。


<iframe src="https://drive.google.com/file/d/19pIibIQVLJ9w9w3OmcliwBVJxXo6LRiI/preview" width="640" height="360" allow="fullscreen"></iframe>
　
##  ポートセキュリティとは

ポートセキュリティとは、スイッチの特定のポートに接続できるデバイスを**MACアドレス**に基づいて制限する機能です。

### 目的

1.  **不正アクセス防止:** 許可されていないPCやサーバーがネットワークに接続されるのを防ぎます。
2.  **MACアドレスフラッピング防止:** スイッチのMACアドレステーブルの混乱を防ぎ、安定性を高めます。

### 制限事項

ポートセキュリティは、原則として**アクセスポート**（PCなどの端末が接続されるポート）にのみ設定できます。  
トランクポートやEtherChannelには設定できません。

-----

## MACアドレスの学習方法（制限の設定）

ポートに接続を許可するMACアドレスをスイッチに認識させる方法には、主に3種類あります。

| 学習方法 | 定義 | 特徴 | 
| :--- | :--- | :--- |
| **スタティック**<br />(Static) | **手動設定** | 管理者がMACアドレスを直接入力する。最も厳格だが、運用負荷が高い。 |
| **ダイナミック**<br />(Dynamic) | **自動学習** | スイッチがポートに接続された最初のMACアドレスを自動で学習する。再起動すると学習したMACアドレスは消える。 |
| **スティッキー**<br />(Sticky) | **学習＋保存** | 自動学習したMACアドレスを、設定ファイルに自動的に記録・保存する。再起動後も設定が保持されるため、**実運用で最も一般的**。 |

### コマンド（スティッキーの設定例）

ポートセキュリティを有効にし、学習数を1つに制限、学習方法をスティッキーに設定する手順です。

```cli
Switch(config)# interface FastEthernet 0/1
Switch(config-if)# switchport mode access
Switch(config-if)# switchport port-security             // 1. ポートセキュリティを有効化
Switch(config-if)# switchport port-security maximum 1   // 2. 接続可能なMACアドレス数を1に制限
Switch(config-if)# switchport port-security mac-address sticky // 3. スティッキー学習を有効化
```

-----

## 違反モード（不正アクセス時の動作）

許可されていないMACアドレスが接続された場合に、スイッチがどのような行動を取るかを設定します。

| 違反モード | 動作 | 通知 (Syslog) | ポートの回復 |
| :--- | :--- | :--- | :--- |
| **Protect** | **不正パケットを破棄** | ❌ **しない** | 自動で回復（パケットが来なくなれば復帰） |
| **Restrict** | **不正パケットを破棄** | ✅ **する**（通知、SNMPトラップ） | 自動で回復 |
| **Shutdown** | **ポートを即座に閉鎖** | ✅ **する**（通知、SNMPトラップ） | **手動**または**タイマー設定**でのみ回復 |

:::tip ポイント
**Shutdown**モードが最も安全性が高いですが、復旧に手動操作が必要になります。  
実運用では即座に管理者への通知が行われる **Restrict** モードも多く利用されます。
:::
### コマンド（違反モードの設定）

```cli
Switch(config-if)# switchport port-security violation shutdown // Shutdownモードを設定（デフォルト）
// または
Switch(config-if)# switchport port-security violation restrict
```

### 確認コマンド

```cli
Switch# show port-security interface FastEthernet 0/1 // 特定ポートの詳細確認
Switch# show port-security address                     // 学習したMACアドレスの一覧確認
```
　
<iframe src="https://drive.google.com/file/d/1mUJ5tDlurcnE6cp6PQyc1VzndC3h6Xye/preview" width="640" height="360" allow="fullscreen"></iframe>

　

    </div>
</details>

<details>
    <summary>確認問題</summary>
    <div>
以下のファイルをダウンロードし、回答を記入して担当講師に送信して下さい。

[**確認問題**](./files/15.セキュリティ_確認課題_名前.xlsx)
    </div>
</details>